#!/bin/bash
mongo localhost:27017/item --eval 'db.item.aggregate([{"$match":{"$and":[{"$or":[{"store_sales.customer.hd_dep_count":5},{"store_sales.customer.hd_vehicle_count":{"$gt":2}}]},{"store_sales.date.d_year":{"$in":[1998,1999,2000]}},{"store_sales.date.d_dow":1},{"store_sales.s_number_employees":{"$gte":200, "$lte":295}}]}},{"$unwind": "$store_sales"},{"$match":{"$and":[{"$or":[{"store_sales.customer.hd_dep_count":5},{"store_sales.customer.hd_vehicle_count":{"$gt":2}}]},{"store_sales.date.d_year":{"$in":[1998,1999,2000]}},{"store_sales.date.d_dow":1},{"store_sales.s_number_employees":{"$gte":200, "$lte":295}}]}},{"$project":{"store_sales.ss_ticket_number":1, "store_sales.customer.c_customer_sk":1, "store_sales.s_city":1,"store_sales.ss_coupon_amt":1}},{"$group":{"_id":{"ss_ticket_number":"$store_sales.ss_ticket_number", "store_sales.customer.c_customer_sk":"$store_sales.customer.c_customer_sk", "s_city":"$store_sales.s_city"}, "amt":{"$sum":"$store_sales.ss_coupon_amt"}}}]).toArray()' >>~/Documentos/benchmarktpc/mongoDB/item/resultados/query8.txt